# âœ… ì˜¬ë°”ë¥¸ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ìµœì¢…)

## ğŸš¨ ì¤‘ìš”: Railway ì„¤ì •ì„ ì´ë ‡ê²Œ ë°”ê¾¸ì„¸ìš”!

---

## Sentinel-Worker í™˜ê²½ ë³€ìˆ˜ (í•„ìˆ˜!)

### âŒ ì˜ëª»ëœ ì„¤ì • (í˜„ì¬)

```bash
FORCE_MARKET_OPEN=true          # âŒ ì£¼ë§ì—ë„ ê°ì‹œí•˜ê²Œ ë¨
WATCH_INTERVAL_SEC=180          # âŒ 3ë¶„ë§ˆë‹¤ ê°ì‹œ (ë„ˆë¬´ ìì£¼)
```

### âœ… ì˜¬ë°”ë¥¸ ì„¤ì • (ìˆ˜ì •í•´ì•¼ í•¨)

```bash
# ê¸°ë³¸ ì„¤ì •
LOG_LEVEL=INFO
WATCH_INTERVAL_SEC=1800         # âœ… 30ë¶„ë§ˆë‹¤ ê°ì‹œ

# ê°•ì œ ëª¨ë“œ ë¹„í™œì„±í™” (íœ´ì¥ì¼ì—ëŠ” ì‰¬ì–´ì•¼ í•¨)
FORCE_MARKET_OPEN=false         # âœ… ì£¼ë§/ê³µíœ´ì¼ì—ëŠ” ê°ì‹œ ì•ˆ í•¨

# VIX í•„í„°
VIX_FILTER_THRESHOLD=0.8

# K200 ì„ ë¬¼ (DBì¦ê¶Œ API)
DBSEC_ENABLE=true
K200_CHECK_INTERVAL_MIN=30
DB_FUTURES_CODE=101RB000
DB_API_BASE=https://openapi.dbsec.co.kr:8443
DB_APP_KEY=your_db_app_key
DB_APP_SECRET=your_db_app_secret

# Sentinel ì—°ê²°
SENTINEL_BASE_URL=https://your-sentinel-url.railway.app
SENTINEL_KEY=your_sentinel_key
```

---

## ğŸ“Š ì •ìƒ ì‘ë™ ì‹œê°„í‘œ

| ì‹œê°„ (KST) | ìš”ì¼ | ì„¸ì…˜ | ê°ì‹œ ëŒ€ìƒ |
|-----------|------|------|----------|
| **09:00-15:30** | **í‰ì¼** | **KR** | **KOSPI, KODEX, TIGER, KS200 + K200 ì„ ë¬¼** |
| 15:30-18:00 | í‰ì¼ | CLOSED | ëŒ€ê¸° |
| **18:00-22:30** | **í‰ì¼** | **FUTURES** | **ë¯¸êµ­ ì„ ë¬¼ + K200 ì„ ë¬¼ (ì•¼ê°„)** |
| **22:30-05:00** | **í‰ì¼** | **US** | **S&P 500, NASDAQ, VIX + K200 ì„ ë¬¼ (ì•¼ê°„)** |
| 05:00-09:00 | í‰ì¼ | CLOSED | ëŒ€ê¸° |
| **ì „ì²´** | **ì£¼ë§** | **CLOSED** | **ê°ì‹œ ì•ˆ í•¨** |
| **ì „ì²´** | **ê³µíœ´ì¼** | **CLOSED** | **ê°ì‹œ ì•ˆ í•¨** |

---

## ğŸ”„ ì‹œìŠ¤í…œ ë¡œì§ (ìˆ˜ì •ë¨)

### 1. íœ´ì¥ì¼ ì²´í¬ (ìµœìš°ì„ )
```python
# ì£¼ë§ì¸ê°€?
if now_kst.weekday() >= 5:  # í† , ì¼
    return  # ëª¨ë“  ê°ì‹œ ì¤‘ë‹¨

# ê³µíœ´ì¼ì¸ê°€?
if (month, day) in kr_holidays:
    return  # ëª¨ë“  ê°ì‹œ ì¤‘ë‹¨
```

### 2. ì„¸ì…˜ ê°ì§€
```python
hhmm = hour * 100 + minute

if 900 <= hhmm <= 1530:      # 09:00-15:30
    session = "KR"
elif 2230 <= hhmm or hhmm < 500:  # 22:30-05:00
    session = "US"
elif 1530 < hhmm < 2230:     # 15:30-22:30
    session = "FUTURES"
else:
    session = "CLOSED"
```

### 3. K200 ì„ ë¬¼ ì²´í¬ (30ë¶„ë§ˆë‹¤)
```python
# ê±°ë˜ ì‹œê°„ì¸ê°€?
is_day = (900 <= hhmm <= 1530)      # ì£¼ê°„ 09:00-15:30
is_night = (hhmm >= 1800) or (hhmm < 500)  # ì•¼ê°„ 18:00-05:00

# í‰ì¼ì´ê³  ê±°ë˜ ì‹œê°„ì´ë©´ ì²´í¬
if not is_weekend and not is_holiday and (is_day or is_night):
    check_k200_futures()
```

### 4. ì¼ë°˜ ì§€ìˆ˜ ê°ì‹œ (30ë¶„ë§ˆë‹¤)
```python
if session == "KR":
    watch_symbols = ["KOSPI", "KODEX", "TIGER", "KS200"]
elif session == "US":
    watch_symbols = ["S&P 500", "NASDAQ", "VIX"]
elif session == "FUTURES":
    watch_symbols = ["ES", "NQ"]  # ë¯¸êµ­ ì„ ë¬¼
```

---

## ğŸ› í˜„ì¬ ë¬¸ì œ ë¶„ì„

### ë¬¸ì œ 1: í† ìš”ì¼ ì˜¤í›„ì— ë¯¸êµ­ì¥ ê°ì‹œ
**ì›ì¸:** `FORCE_MARKET_OPEN=true` ì„¤ì •

**ë¡œê·¸:**
```
2025-10-11 05:46:26,975 - ì‹œì¥ ì²´í¬ ì‹œì‘ [ì„¸ì…˜: CLOSED] 2025-10-11 14:46:26 KST
2025-10-11 05:46:26,975 - ğŸ”´ ê°•ì œ ì‹œì¥ ì˜¤í”ˆ ëª¨ë“œ í™œì„±í™” - íœ´ì¥ì¼ì—ë„ ê°ì‹œ ê³„ì†
2025-10-11 05:46:27,742 - ğŸ”´ ê°•ì œ ëª¨ë“œ: íœ´ì¥ ì¤‘ì—ë„ ë¯¸êµ­ ì‹œì¥ ê°ì‹œ
2025-10-11 05:46:27,742 - ã€ë¯¸êµ­ ì •ê·œì¥ã€‘ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...
```

**í•´ê²°:**
```bash
FORCE_MARKET_OPEN=false  # â† ì´ë ‡ê²Œ ë³€ê²½!
```

**ìˆ˜ì • í›„ ì˜ˆìƒ ë¡œê·¸:**
```
2025-10-11 14:46:26 - ì‹œì¥ ì²´í¬ ì‹œì‘ [ì„¸ì…˜: CLOSED] 2025-10-11 14:46:26 KST
2025-10-11 14:46:26 - ì£¼ë§ íœ´ì¥ - ëª¨ë“  ì‹œì¥ ê°ì‹œ ì¤‘ë‹¨
```

### ë¬¸ì œ 2: 3ë¶„ë§ˆë‹¤ ê°ì‹œ (ë„ˆë¬´ ìì£¼)
**ì›ì¸:** `WATCH_INTERVAL_SEC=180` (3ë¶„)

**ë¡œê·¸ ì‹œê°„ ê°„ê²©:**
```
05:30:18 â†’ 05:33:30 (3ë¶„ 12ì´ˆ)
05:33:30 â†’ 05:36:47 (3ë¶„ 17ì´ˆ)
05:36:47 â†’ 05:40:02 (3ë¶„ 15ì´ˆ)
```

**í•´ê²°:**
```bash
WATCH_INTERVAL_SEC=1800  # 30ë¶„ (ì‚¬ìš©ì ìš”ì²­)
```

**ìˆ˜ì • í›„ ì˜ˆìƒ ê°„ê²©:**
```
05:00:00 â†’ 05:30:00 (30ë¶„)
05:30:00 â†’ 06:00:00 (30ë¶„)
```

### ë¬¸ì œ 3: ì½”ìŠ¤í”¼ ì§€ìˆ˜ë“¤ ê°ì‹œ ì•ˆ ë¨
**ì›ì¸:** ê¸°ì¡´ ì½”ë“œì—ì„œ `KR_SPOT_PRIORITY[:1]` (KOSPIë§Œ)

**ê¸°ì¡´ ì½”ë“œ:**
```python
if sess == "KR":
    symbols = KR_SPOT_PRIORITY[:1]  # KOSPIë§Œ
```

**ìˆ˜ì •ëœ ì½”ë“œ:**
```python
if sess == "KR":
    symbols = KR_SPOT_PRIORITY  # ì „ì²´: KOSPI, KODEX, TIGER, KS200
```

**ìˆ˜ì • í›„ ì˜ˆìƒ ë¡œê·¸ (í‰ì¼ 09:00-15:30):**
```
ã€í•œêµ­ ì •ê·œì¥ã€‘ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...
âœ“ KOSPI: í˜„ì¬=2543.21, ì „ì¼ëŒ€ë¹„=-0.52%, ì¼ì¤‘ë³€ë™=0.35%
âœ“ KODEX 200: í˜„ì¬=33450, ì „ì¼ëŒ€ë¹„=-0.48%, ì¼ì¤‘ë³€ë™=0.28%
âœ“ TIGER 200: í˜„ì¬=33420, ì „ì¼ëŒ€ë¹„=-0.49%, ì¼ì¤‘ë³€ë™=0.29%
âœ“ KOSPI 200: í˜„ì¬=341.50, ì „ì¼ëŒ€ë¹„=-0.50%, ì¼ì¤‘ë³€ë™=0.30%
ğŸ“Š K200 ì„ ë¬¼ ì²´í¬ ì‹œì‘...
âœ“ K200 ì„ ë¬¼: í˜„ì¬=341.75, ë³€í™”=-0.45%
```

### ë¬¸ì œ 4: DBì¦ê¶Œ API 403 ì—ëŸ¬
**ì›ì¸:** API í‚¤ ë¬¸ì œ ë˜ëŠ” ì£¼ë§/ê³µíœ´ì¼ API ì ‘ê·¼ ì œí•œ

**ë¡œê·¸:**
```
2025-10-11 05:43:16,366 - ERROR - DBì¦ê¶Œ í† í° ë°œê¸‰ ì‹¤íŒ¨: 403
```

**í•´ê²°:**
1. DBì¦ê¶Œ API í‚¤ ì¬í™•ì¸
2. ì£¼ë§ì—ëŠ” API ìì²´ê°€ ë§‰í˜€ìˆì„ ìˆ˜ ìˆìŒ (ì •ìƒ)
3. í‰ì¼ ê±°ë˜ ì‹œê°„ì— ë‹¤ì‹œ í…ŒìŠ¤íŠ¸

---

## ğŸ¯ Railway ì„¤ì • ë³€ê²½ ë‹¨ê³„

### 1. Railway ëŒ€ì‹œë³´ë“œ ì ‘ì†
```
https://railway.app
â†’ sentinel-worker ì„œë¹„ìŠ¤ ì„ íƒ
â†’ Variables íƒ­
```

### 2. ë‹¤ìŒ ë³€ìˆ˜ë“¤ ìˆ˜ì •
```bash
âŒ FORCE_MARKET_OPEN=true
âœ… FORCE_MARKET_OPEN=false

âŒ WATCH_INTERVAL_SEC=180
âœ… WATCH_INTERVAL_SEC=1800
```

### 3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
```
Railwayì—ì„œ ìë™ ì¬ë°°í¬ ëŒ€ê¸° (ì•½ 1-2ë¶„)
ë˜ëŠ”
railway restart --service sentinel-worker
```

### 4. ë¡œê·¸ í™•ì¸
```bash
railway logs --service sentinel-worker
```

**ì£¼ë§/ê³µíœ´ì¼ ì˜ˆìƒ ë¡œê·¸:**
```
ì‹œì¥ ì²´í¬ ì‹œì‘ [ì„¸ì…˜: CLOSED] 2025-10-11 14:46:26 KST
ì£¼ë§ íœ´ì¥ - ëª¨ë“  ì‹œì¥ ê°ì‹œ ì¤‘ë‹¨
```

**í‰ì¼ ì •ê·œì¥ ì˜ˆìƒ ë¡œê·¸ (09:00-15:30):**
```
ì‹œì¥ ì²´í¬ ì‹œì‘ [ì„¸ì…˜: KR] 2025-10-15 10:30:00 KST
ğŸ“Š K200 ì„ ë¬¼ ê°ì‹œ í™œì„±í™” (DBì¦ê¶Œ API)
ğŸ“Š K200 ì„ ë¬¼ ì²´í¬ ì‹œì‘...
âœ“ K200 ì„ ë¬¼: í˜„ì¬=341.50, ë³€í™”=-0.50%
ã€í•œêµ­ ì •ê·œì¥ã€‘ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...
âœ“ KOSPI: í˜„ì¬=2543.21, ì „ì¼ëŒ€ë¹„=-0.52%
âœ“ KODEX 200: í˜„ì¬=33450, ì „ì¼ëŒ€ë¹„=-0.48%
âœ“ TIGER 200: í˜„ì¬=33420, ì „ì¼ëŒ€ë¹„=-0.49%
âœ“ KOSPI 200: í˜„ì¬=341.50, ì „ì¼ëŒ€ë¹„=-0.50%
ì²´í¬ ì™„ë£Œ
```

**í‰ì¼ ì•¼ê°„ ì˜ˆìƒ ë¡œê·¸ (18:00-05:00):**
```
ì‹œì¥ ì²´í¬ ì‹œì‘ [ì„¸ì…˜: US] 2025-10-15 23:00:00 KST
ğŸ“Š K200 ì„ ë¬¼ ê°ì‹œ í™œì„±í™” (DBì¦ê¶Œ API)
ğŸ“Š K200 ì„ ë¬¼ ì²´í¬ ì‹œì‘...
âœ“ K200 ì„ ë¬¼: í˜„ì¬=341.75, ë³€í™”=-0.45% (ì•¼ê°„)
ã€ë¯¸êµ­ ì •ê·œì¥ã€‘ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...
âœ“ S&P 500: í˜„ì¬=6552.51, ì „ì¼ëŒ€ë¹„=-2.71%
âœ“ NASDAQ: í˜„ì¬=22204.43, ì „ì¼ëŒ€ë¹„=-3.56%
âœ“ VIX: ê°’=21.66, ë³€í™”ìœ¨=31.83%
ì²´í¬ ì™„ë£Œ
```

---

## âœ… ìˆ˜ì • ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Railway ì„¤ì •
- [ ] `FORCE_MARKET_OPEN=false` ì„¤ì •
- [ ] `WATCH_INTERVAL_SEC=1800` ì„¤ì •
- [ ] ì„œë¹„ìŠ¤ ì¬ì‹œì‘
- [ ] ë¡œê·¸ í™•ì¸

### ì½”ë“œ ìˆ˜ì • (ì™„ë£Œ)
- [x] ì£¼ë§ íœ´ì¥ ì²´í¬
- [x] ê³µíœ´ì¼ íœ´ì¥ ì²´í¬
- [x] K200 ì„ ë¬¼ ì‹œê°„ëŒ€ ì²´í¬ (ì£¼ê°„+ì•¼ê°„, í‰ì¼ë§Œ)
- [x] í•œêµ­ ì§€ìˆ˜ ì „ì²´ ê°ì‹œ (KOSPI, KODEX, TIGER, KS200)
- [x] FORCE_MARKET_OPEN ë¡œì§ ìˆ˜ì •

### í…ŒìŠ¤íŠ¸ (í‰ì¼ì— í™•ì¸)
- [ ] í‰ì¼ 09:00-15:30: í•œêµ­ ì§€ìˆ˜ + K200 ì„ ë¬¼ ê°ì‹œ
- [ ] í‰ì¼ 18:00-05:00: ë¯¸êµ­ ì§€ìˆ˜ + K200 ì„ ë¬¼ ì•¼ê°„ ê°ì‹œ
- [ ] ì£¼ë§: ëª¨ë“  ê°ì‹œ ì¤‘ë‹¨
- [ ] 30ë¶„ ê°„ê²©ìœ¼ë¡œ ì²´í¬

---

## ğŸ“ ë¬¸ì œ í•´ê²°

### Q: ì£¼ë§ì—ë„ ê³„ì† ë¡œê·¸ê°€ ë‚˜ì™€ìš”
**A:** `FORCE_MARKET_OPEN=false`ë¡œ ë³€ê²½í•˜ê³  ì¬ì‹œì‘í•˜ì„¸ìš”.

### Q: 3ë¶„ë§ˆë‹¤ ì²´í¬ë˜ê³  ìˆì–´ìš”
**A:** `WATCH_INTERVAL_SEC=1800`ìœ¼ë¡œ ë³€ê²½í•˜ê³  ì¬ì‹œì‘í•˜ì„¸ìš”.

### Q: ì½”ìŠ¤í”¼ ì•Œë¦¼ì´ ì•ˆ ì™€ìš”
**A:** ì½”ë“œ ìˆ˜ì • ì™„ë£Œ, GitHubì—ì„œ pullí•˜ê³  Railway ì¬ë°°í¬í•˜ì„¸ìš”.

### Q: K200 ì„ ë¬¼ì´ 403 ì—ëŸ¬
**A:** 
1. ì£¼ë§/ê³µíœ´ì¼ì—ëŠ” DBì¦ê¶Œ APIê°€ ë§‰í˜€ìˆì„ ìˆ˜ ìˆìŒ (ì •ìƒ)
2. API í‚¤ ì¬í™•ì¸
3. í‰ì¼ ê±°ë˜ ì‹œê°„(09:00-15:30, 18:00-05:00)ì— ë‹¤ì‹œ í…ŒìŠ¤íŠ¸

---

**ì‘ì„±ì¼:** 2025-10-11  
**ë²„ì „:** 2.0 (ì „ë©´ ìˆ˜ì •)  
**ì»¤ë°‹:** `d8b86d6` - fix(critical): ì‹œì¥ ê°ì‹œ ë¡œì§ ì „ë©´ ìˆ˜ì •

**ê°€ì¥ ì¤‘ìš”í•œ ê²ƒ:**
```bash
FORCE_MARKET_OPEN=false      # ì£¼ë§ì— ì‰¬ì–´ì•¼ í•¨!
WATCH_INTERVAL_SEC=1800      # 30ë¶„ë§ˆë‹¤ ì²´í¬!
```
